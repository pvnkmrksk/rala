<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Complete index of all English words in Rala dictionary">
    <title>Index / Glossary - Rala</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rala">
    <link rel="apple-touch-icon" href="icon.svg">
    <link rel="stylesheet" href="styles.css?v=2.12">
    <style>
        .glossary-container {
            padding: 20px;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .glossary-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .glossary-search {
            margin-bottom: 30px;
        }
        
        .glossary-search input {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            display: block;
            padding: 12px 16px;
            font-size: 18px;
            border: 1px solid var(--input-border);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
        }
        
        .glossary-stats {
            text-align: center;
            color: var(--text-color-light);
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .glossary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            max-width: 100%;
        }
        
        .glossary-word {
            padding: 8px 12px;
            background: var(--section-bg);
            border: 1px solid var(--border-color-light);
            border-radius: 4px;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.2s;
            font-size: 14px;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .glossary-word:hover {
            background: var(--hover-bg);
            border-color: var(--text-color);
        }
        
        .glossary-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-color-light);
        }
        
        .glossary-letters {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--section-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color-light);
        }
        
        .glossary-letter {
            padding: 8px 12px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            min-width: 36px;
            text-align: center;
        }
        
        .glossary-letter:hover {
            background: var(--hover-bg);
            border-color: var(--text-color);
        }
        
        .glossary-letter.active {
            background: var(--text-color);
            color: var(--bg-color);
            border-color: var(--text-color);
        }
        
        .glossary-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .glossary-page-btn {
            padding: 8px 12px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            text-decoration: none;
            color: var(--text-color);
            font-size: 14px;
            transition: all 0.2s;
            min-width: 40px;
            text-align: center;
        }
        
        .glossary-page-btn:hover {
            background: var(--hover-bg);
            border-color: var(--text-color);
        }
        
        .glossary-page-btn.active {
            background: var(--text-color);
            color: var(--bg-color);
            border-color: var(--text-color);
        }
        
        .glossary-page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .glossary-list {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 6px;
            }
            
            .glossary-word {
                font-size: 13px;
                padding: 6px 10px;
            }
            
            .glossary-letters {
                gap: 6px;
                padding: 15px;
            }
            
            .glossary-letter {
                padding: 6px 10px;
                font-size: 13px;
                min-width: 32px;
            }
            
            .glossary-pagination {
                gap: 6px;
            }
            
            .glossary-page-btn {
                padding: 6px 10px;
                font-size: 13px;
                min-width: 36px;
            }
        }
    </style>
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="hamburger-menu" id="hamburger-menu" title="Open menu" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ರಲ</h2>
            <button class="sidebar-close" id="sidebar-close" aria-label="Close menu">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="index.html" class="sidebar-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Home</span>
            </a>
            <a href="about.html" class="sidebar-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <span>About</span>
            </a>
            <a href="index.html" class="sidebar-link" id="install-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <span>Install App</span>
            </a>
            <a href="glossary.html" class="sidebar-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    <line x1="9" y1="7" x2="15" y2="7"></line>
                    <line x1="9" y1="11" x2="15" y2="11"></line>
                    <line x1="9" y1="15" x2="13" y2="15"></line>
                </svg>
                <span>Index / Glossary</span>
            </a>
        </nav>
    </div>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <button class="dark-mode-toggle" id="dark-mode-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
        <svg id="dark-mode-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
    </button>
    
    <div class="header">
        <h1>ರಲ</h1>
        <p class="subtitle">
            <span class="subtitle-line">Index / Glossary</span>
            <span class="subtitle-line">Complete list of all English words</span>
        </p>
    </div>
    
    <div class="glossary-container">
        <div class="glossary-header">
            <div class="glossary-search">
                <input type="text" id="glossary-search" placeholder="Search words..." autofocus>
            </div>
            <div class="glossary-stats" id="glossary-stats">Loading...</div>
        </div>
        
        <div class="glossary-letters" id="glossary-letters" style="display: none;"></div>
        
        <div class="glossary-loading" id="glossary-loading">Loading words...</div>
        <div class="glossary-list" id="glossary-list"></div>
        
        <div class="glossary-pagination" id="glossary-pagination" style="display: none;"></div>
    </div>
    
    <footer class="attribution">
        <div class="footer-nav">
            <a href="index.html">Home</a>
            <a href="about.html">About</a>
            <a href="index.html" id="footer-install-link">Install App</a>
            <a href="glossary.html">Index / Glossary</a>
        </div>
        <div class="footer-links">
            <a href="https://github.com/pvnkmrksk/rala" target="_blank"><strong>Rala (ರಲ)</strong></a>
            <a href="https://alar.ink">Alar</a>
            <a href="https://padakanaja.karnataka.gov.in">Padakanaja</a>
        </div>
        <div style="margin-top: 20px; font-size: 12px; color: var(--text-color-lighter);">
            Made with ❤️ by <a href="https://github.com/pvnkmrksk" target="_blank" style="color: var(--text-color); text-decoration: underline;">pvnkmrksk</a>
        </div>
    </footer>
    
    <script src="js/config.js?v=2.13"></script>
    <script src="js/storage.js?v=2.13"></script>
    <script src="js/utils.js?v=2.13"></script>
    <script src="js/sidebar.js?v=2.13"></script>
    <script src="js/dictionary.js?v=2.13"></script>
    <script>
        initDarkMode();
        initSidebar();
        
        // Load and display glossary
        async function loadGlossary() {
            const loadingEl = document.getElementById('glossary-loading');
            const listEl = document.getElementById('glossary-list');
            const statsEl = document.getElementById('glossary-stats');
            const searchInput = document.getElementById('glossary-search');
            const lettersEl = document.getElementById('glossary-letters');
            const paginationEl = document.getElementById('glossary-pagination');
            
            let allWords = [];
            let currentPage = 1;
            let currentLetter = null;
            let wordsPerPage = 500;
            
            try {
                // Load Alar dictionary to get all English words
                // Use the same method as the main page
                if (typeof loadAlarFromYAML === 'function') {
                    await loadAlarFromYAML();
                } else if (typeof loadDictionary === 'function') {
                    await loadDictionary();
                }
                
                // Build reverse index to get all English words
                if (typeof buildReverseIndex === 'function') {
                    buildReverseIndex();
                }
                
                // Get all English words from reverse index
                if (typeof allEnglishWords !== 'undefined' && allEnglishWords instanceof Set) {
                    allWords = Array.from(allEnglishWords).sort();
                } else {
                    // Fallback: try to get words from dictionary entries
                    if (typeof dictionary !== 'undefined' && Array.isArray(dictionary)) {
                        const wordSet = new Set();
                        dictionary.forEach(entry => {
                            if (entry.defs) {
                                entry.defs.forEach(def => {
                                    if (def.entry) {
                                        const words = def.entry.toLowerCase().match(/\b[a-z]+\b/g);
                                        if (words) {
                                            words.forEach(w => wordSet.add(w));
                                        }
                                    }
                                });
                            }
                        });
                        allWords = Array.from(wordSet).sort();
                    }
                }
                
                if (allWords.length === 0) {
                    loadingEl.textContent = 'No words found. Please refresh the page.';
                    return;
                }
                
                statsEl.textContent = `${allWords.length.toLocaleString()} English words`;
                loadingEl.style.display = 'none';
                
                // Create letter navigation
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                lettersEl.innerHTML = '';
                letters.forEach(letter => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'glossary-letter';
                    link.textContent = letter;
                    link.onclick = (e) => {
                        e.preventDefault();
                        currentLetter = letter;
                        currentPage = 1;
                        searchInput.value = '';
                        filterAndDisplay();
                        updateActiveLetter(letter);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    };
                    lettersEl.appendChild(link);
                });
                lettersEl.style.display = 'flex';
                
                // Display words with pagination
                function filterAndDisplay() {
                    let filtered = allWords;
                    
                    // Filter by letter if selected
                    if (currentLetter) {
                        filtered = filtered.filter(word => 
                            word.toUpperCase().startsWith(currentLetter)
                        );
                    }
                    
                    // Filter by search query
                    const query = searchInput.value.toLowerCase().trim();
                    if (query) {
                        filtered = filtered.filter(word => 
                            word.toLowerCase().includes(query)
                        );
                        currentLetter = null; // Clear letter filter when searching
                        updateActiveLetter(null);
                    }
                    
                    // Calculate pagination
                    const totalPages = Math.ceil(filtered.length / wordsPerPage);
                    const startIndex = (currentPage - 1) * wordsPerPage;
                    const endIndex = startIndex + wordsPerPage;
                    const pageWords = filtered.slice(startIndex, endIndex);
                    
                    // Display words
                    listEl.innerHTML = '';
                    pageWords.forEach(word => {
                        const link = document.createElement('a');
                        link.href = `index.html?q=${encodeURIComponent(word)}`;
                        link.className = 'glossary-word';
                        link.textContent = word;
                        listEl.appendChild(link);
                    });
                    
                    // Update stats
                    if (query || currentLetter) {
                        statsEl.textContent = `Showing ${pageWords.length.toLocaleString()} of ${filtered.length.toLocaleString()} words (Page ${currentPage} of ${totalPages})`;
                    } else {
                        statsEl.textContent = `${allWords.length.toLocaleString()} English words (Page ${currentPage} of ${totalPages})`;
                    }
                    
                    // Update pagination
                    updatePagination(totalPages);
                }
                
                function updateActiveLetter(letter) {
                    lettersEl.querySelectorAll('.glossary-letter').forEach(link => {
                        link.classList.toggle('active', link.textContent === letter);
                    });
                }
                
                function updatePagination(totalPages) {
                    if (totalPages <= 1) {
                        paginationEl.style.display = 'none';
                        return;
                    }
                    
                    paginationEl.style.display = 'flex';
                    paginationEl.innerHTML = '';
                    
                    // Previous button
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'glossary-page-btn';
                    prevBtn.textContent = '←';
                    prevBtn.disabled = currentPage === 1;
                    prevBtn.onclick = (e) => {
                        e.preventDefault();
                        if (currentPage > 1) {
                            currentPage--;
                            filterAndDisplay();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                    };
                    paginationEl.appendChild(prevBtn);
                    
                    // Page numbers (show up to 10 pages around current)
                    const startPage = Math.max(1, currentPage - 5);
                    const endPage = Math.min(totalPages, currentPage + 5);
                    
                    if (startPage > 1) {
                        const firstBtn = document.createElement('a');
                        firstBtn.href = '#';
                        firstBtn.className = 'glossary-page-btn';
                        firstBtn.textContent = '1';
                        firstBtn.onclick = (e) => {
                            e.preventDefault();
                            currentPage = 1;
                            filterAndDisplay();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        };
                        paginationEl.appendChild(firstBtn);
                        if (startPage > 2) {
                            const ellipsis = document.createElement('span');
                            ellipsis.textContent = '...';
                            ellipsis.style.padding = '8px 4px';
                            ellipsis.style.color = 'var(--text-color-light)';
                            paginationEl.appendChild(ellipsis);
                        }
                    }
                    
                    for (let i = startPage; i <= endPage; i++) {
                        const pageBtn = document.createElement('a');
                        pageBtn.href = '#';
                        pageBtn.className = 'glossary-page-btn';
                        if (i === currentPage) pageBtn.classList.add('active');
                        pageBtn.textContent = i.toString();
                        pageBtn.onclick = (e) => {
                            e.preventDefault();
                            currentPage = i;
                            filterAndDisplay();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        };
                        paginationEl.appendChild(pageBtn);
                    }
                    
                    if (endPage < totalPages) {
                        if (endPage < totalPages - 1) {
                            const ellipsis = document.createElement('span');
                            ellipsis.textContent = '...';
                            ellipsis.style.padding = '8px 4px';
                            ellipsis.style.color = 'var(--text-color-light)';
                            paginationEl.appendChild(ellipsis);
                        }
                        const lastBtn = document.createElement('a');
                        lastBtn.href = '#';
                        lastBtn.className = 'glossary-page-btn';
                        lastBtn.textContent = totalPages.toString();
                        lastBtn.onclick = (e) => {
                            e.preventDefault();
                            currentPage = totalPages;
                            filterAndDisplay();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        };
                        paginationEl.appendChild(lastBtn);
                    }
                    
                    // Next button
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'glossary-page-btn';
                    nextBtn.textContent = '→';
                    nextBtn.disabled = currentPage === totalPages;
                    nextBtn.onclick = (e) => {
                        e.preventDefault();
                        if (currentPage < totalPages) {
                            currentPage++;
                            filterAndDisplay();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                    };
                    paginationEl.appendChild(nextBtn);
                }
                
                // Initial display
                filterAndDisplay();
                
                // Search functionality
                searchInput.addEventListener('input', (e) => {
                    currentPage = 1;
                    filterAndDisplay();
                });
                
            } catch (error) {
                console.error('Error loading glossary:', error);
                loadingEl.textContent = 'Error loading words. Please refresh the page.';
            }
        }
        
        loadGlossary();
    </script>
</body>
</html>

